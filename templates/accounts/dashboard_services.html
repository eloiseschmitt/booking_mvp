<section class="kitlast-content-section{% if section == 'services' %} is-active{% endif %}"
  data-section="services">
  <header class="kitlast-section-header">
    <div>
      <h2>Vos catégories & prestations</h2>
      <p class="kitlast-section-header__text">Organisez vos offres par catégorie et gardez une vue claire sur vos prestations.</p>
    </div>
  </header>

  <div class="kitlast-category-board">
    {% if categories %}
      <ul>
        {% for category in categories %}
          <li class="kitlast-category-card">
            <header class="kitlast-category-card__header">
              <h3>{{ category.name|upper }}</h3>
            </header>
            <ul class="kitlast-service-lines">
              {% if category.services.all %}
                {% for service in category.services.all %}
                  <li class="kitlast-service-line">
                    <div class="kitlast-service-line__info">
                      <span class="kitlast-service-line__name">{{ service.name }}</span>
                      <span class="kitlast-service-line__meta">
                        {% if service.price %}<span>{{ service.price }} €</span>{% endif %}
                        {% if service.duration_minutes %}<span>{{ service.duration_minutes }} min</span>{% endif %}
                      </span>
                    </div>
                    <div class="kitlast-service-line__actions">
                      <button type="button" class="kitlast-service-line__action kitlast-service-line__action--muted">Dupliquer</button>
                      <a href="{% url 'dashboard' %}?section=services&show=service-form&service_id={{ service.id }}" class="kitlast-service-line__action">Modifier</a>
                      <form method="post" action="{% url 'dashboard' %}?section=services" class="kitlast-service-line__form" onsubmit="return confirm('Supprimer cette prestation ?');">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete_service">
                        <input type="hidden" name="service_id" value="{{ service.id }}">
                        <button type="submit" class="kitlast-service-line__action kitlast-service-line__action--danger">Supprimer</button>
                      </form>
                    </div>
                  </li>
                {% endfor %}
              {% else %}
                <li class="kitlast-service-line kitlast-service-line--empty">Aucune prestation pour cette catégorie.</li>
              {% endif %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="kitlast-empty">Aucune catégorie pour le moment. Ajoutez votre première catégorie pour structurer vos prestations.</p>
    {% endif %}
  </div>
</section>

<div class="kitlast-modal" data-category-modal {% if not show_category_form and not category_form.errors %}hidden{%endif %}>
  <div class="kitlast-modal__overlay" data-modal-close></div>
  <div class="kitlast-modal__content" role="dialog" aria-modal="true" aria-labelledby="category-modal-title">
    <header class="kitlast-modal__header">
      <h2 id="category-modal-title">Ajouter une catégorie</h2>
      <button type="button" class="kitlast-modal__close" data-modal-close aria-label="Fermer la modale">×</button>
    </header>
    <div class="kitlast-modal__body">
      <form method="post" action="{% url 'dashboard' %}?section=services" class="kitlast-modal__form">
        {% csrf_token %}
        <input type="hidden" name="action" value="add_category">
        <div class="kitlast-field">
          {{ category_form.name.label_tag }}
          {{ category_form.name }}
          {% if category_form.name.errors %}
          <div class="kitlast-field__errors">
            {% for error in category_form.name.errors %}{{ error }}{% endfor %}
          </div>
          {% endif %}
        </div>
        <div class="kitlast-modal__actions">
          <button type="button" class="kitlast-button kitlast-button--ghost" data-modal-close>Annuler</button>
          <button type="submit" class="kitlast-button">Valider</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="kitlast-modal" data-service-modal {% if not show_service_form and not service_form.errors %}hidden{% endif%}>
  <div class="kitlast-modal__overlay" data-modal-close></div>
  <div class="kitlast-modal__content" role="dialog" aria-modal="true" aria-labelledby="service-modal-title">
    <header class="kitlast-modal__header">
      <h2 id="service-modal-title">{% if service_form.instance.pk %}Modifier une prestation{% else %}Ajouter une prestation{% endif %}</h2>
      <button type="button" class="kitlast-modal__close" data-modal-close aria-label="Fermer la modale">×</button>
    </header>
    <div class="kitlast-modal__body">
      <form method="post" action="{% url 'dashboard' %}?section=services" class="kitlast-modal__form">
        {% csrf_token %}
        <input type="hidden" name="action" value="{% if service_form.instance.pk %}update_service{% else %}add_service{% endif %}">
        {% if service_form.instance.pk %}
        <input type="hidden" name="service_id" value="{{ service_form.instance.pk }}">
        {% endif %}
        {% if service_form.non_field_errors %}
        <div class="kitlast-field__errors">
          {% for error in service_form.non_field_errors %}{{ error }}{% endfor %}
        </div>
        {% endif %}
        <div class="kitlast-field">
          {{ service_form.name.label_tag }}
          {{ service_form.name }}
          {% if service_form.name.errors %}
          <div class="kitlast-field__errors">
            {% for error in service_form.name.errors %}{{ error }}{% endfor %}
          </div>
          {% endif %}
        </div>
        <div class="kitlast-field">
          {{ service_form.category.label_tag }}
          {{ service_form.category }}
          {% if service_form.category.errors %}
          <div class="kitlast-field__errors">
            {% for error in service_form.category.errors %}{{ error }}{% endfor %}
          </div>
          {% endif %}
        </div>
        <div class="kitlast-modal__row">
          <div class="kitlast-field">
            {{ service_form.price.label_tag }}
            {{ service_form.price }}
            {% if service_form.price.errors %}
            <div class="kitlast-field__errors">
              {% for error in service_form.price.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
          </div>
          <div class="kitlast-field">
            {{ service_form.duration_minutes.label_tag }}
            {{ service_form.duration_minutes }}
            {% if service_form.duration_minutes.errors %}
            <div class="kitlast-field__errors">
              {% for error in service_form.duration_minutes.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        <div class="kitlast-modal__actions">
          <button type="button" class="kitlast-button kitlast-button--ghost" data-modal-close>Annuler</button>
          <button type="submit" class="kitlast-button">Valider</button>
        </div>
      </form>
    </div>
  </div>
</div>
